name: Post Article to Dev.to

on:
  push:
    branches:
      - main

jobs:
  post-article:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Read markdown file
      id: read-file
      run: |
        file_content=$(cat posts/article.md)
        file_content_json=$(jq -Rs '.' <<< "$file_content")
        echo "::set-output name=content::$file_content_json"

    - name: Post article to Dev.to
      run: |
        curl -X POST -H "Content-Type: application/json" \
            -H "api-key: ${{ secrets.DEV_TO_API_KEY }}" \
            -d '{"article":{"title":"Your Article Title","body_markdown":${{ steps.read-file.outputs.content}},"published":false,"tags":["discuss", "javascript"]}}' \
            https://dev.to/api/articles
      env:
        DEVTO_API_KEY: ${{ secrets.DEV_TO_API_KEY }}
